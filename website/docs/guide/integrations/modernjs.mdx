import { PackageManagerTabs } from '@theme'

# Modern.js

This addon loads a reusable Rsbuild config from your Modern.js configuration file so `storybook-builder-rsbuild` reuses the same settings your application already trusts.

## Getting started

Explore the [Modern.js React example](https://github.com/rspack-contrib/storybook-rsbuild/tree/main/sandboxes/modernjs-react) to see the integration in a real project.

### Installation

<PackageManagerTabs command="install @rsbuild/core storybook-builder-rsbuild storybook-addon-modernjs -D" />

Install `@rsbuild/core` in the same workspace. Without it, the addon cannot read your Modern.js configuration.

Match the version used by `@modern-js/app-tools` when possible. If you install a different release, `storybook-addon-modernjs` prints a warning with the recommended version.

### Setup `.storybook/main.ts`

```ts
import type { StorybookConfig } from 'storybook-react-rsbuild'

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'],
  addons: ['storybook-addon-modernjs'],
  framework: ['storybook-react-rsbuild'],
}
export default config
```

## With Module Federation

Review the [Module Federation example](https://github.com/rspack-contrib/storybook-rsbuild/tree/main/sandboxes/modernjs-react-mf) for a full walkthrough.

### Installation

If your Modern.js app uses Module Federation, install `@module-federation/storybook-addon`.

<PackageManagerTabs command="install @module-federation/storybook-addon -D" />

### Setup `.storybook/main.ts`

Add the addon and pass the `remotes` option manually. Storybook cannot infer it automatically.

```ts
import type { StorybookConfig } from 'storybook-react-rsbuild'
import moduleFederationConfig from '../module-federation.config'

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'],
  addons: [
    'storybook-addon-modernjs',
    {
      name: '@module-federation/storybook-addon',
      options: {
        remotes: moduleFederationConfig.remotes,
      },
    },
  ],
  framework: ['storybook-react-rsbuild'],
}
```

### Setup `modern.config.ts`

When using `@module-federation/storybook-addon`, disable `moduleFederationPlugin` in `modern.config.ts` while Storybook runs.

One approach is to check an environment variable set by your Storybook scripts.

```json title="package.json"
{
  "scripts": {
    "storybook": "STORYBOOK=true storybook dev -p 6006"
  }
}
```

```ts title="modern.config.ts"
import { appTools, defineConfig } from '@modern-js/app-tools'
import { moduleFederationPlugin } from '@module-federation/modern-js'

// https://modernjs.dev/en/configure/app/usage
export default defineConfig({
  runtime: {
    router: true,
  },
  plugins: [
    appTools({
      bundler: 'rspack',
    }),
    ...(process.env.STORYBOOK ? [] : [moduleFederationPlugin()]),
  ],
})
```

## Limitations

Modern.js has its own plugin system that transforms configuration before handing it to Rsbuild.

Modern.js also processes user configuration internally, performing complex changes before Rsbuild sees the result.

:::tip
Therefore, the addon has some limitations in Modern.js.
:::

### üéó Supported Usages

- Modern.js Configuration files
- Modern.js plugins to modify the configuration
- Rsbuild plugins

### üò™ Unsupported Usages

- Webpack cannot be used, only Rspack is supported.
- SSR configuration will not work in Storybook
- Runtime capabilities, such as `<Link>` navigation
- [Modern.js plugins](https://modernjs.dev/plugin/cli-plugins/api.html) will only call the `config` and `resolveConfig` hooks

### ‚òéÔ∏è Contact Us

We now support Storybook through a Storybook addon, not a Storybook framework. As a result, some features of Modern.js are unavailable in Storybook.

If you have any questions or suggestions with Modern.js & Storybook, feel free to contact us.

- [GitHub](https://github.com/web-infra-dev/modern.js)
- [Modern.js Discord](https://discord.gg/qPCqYg38De)
