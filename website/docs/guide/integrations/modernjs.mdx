import { PackageManagerTabs } from '@theme'

# Modern.js

`storybook-addon-modernjs` reads your Modern.js configuration and shares it with Storybook Rsbuild so both builds behave consistently.

See the [Modern.js React sandbox](https://github.com/rspack-contrib/storybook-rsbuild/tree/main/sandboxes/modernjs-react) for a quick start.

## Getting started

### Installation

<PackageManagerTabs command="install @rsbuild/core storybook-builder-rsbuild storybook-addon-modernjs -D" />

Install `@rsbuild/core` alongside the addon. For best results, match the version used by `@modern-js/app-tools`. If the versions differ, the addon prints a warning with the recommended version.

### Configure `.storybook/main.ts`

```ts
import type { StorybookConfig } from 'storybook-react-rsbuild'

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'],
  addons: ['storybook-addon-modernjs'],
  framework: ['storybook-react-rsbuild'],
}

export default config
```

## Module Federation support

Use the [Module Federation sandbox](https://github.com/rspack-contrib/storybook-rsbuild/tree/main/sandboxes/modernjs-react-mf) to see the integration in action.

### Installation

When your Modern.js app uses Module Federation, add `@module-federation/storybook-addon`.

<PackageManagerTabs command="install @module-federation/storybook-addon -D" />

### Configure `.storybook/main.ts`

Manually pass the `remotes` option to the addon (it cannot read the Modern.js config automatically).

```ts
import type { StorybookConfig } from 'storybook-react-rsbuild'
import moduleFederationConfig from '../module-federation.config'

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'],
  addons: [
    'storybook-addon-modernjs',
    {
      name: '@module-federation/storybook-addon',
      options: {
        remotes: moduleFederationConfig.remotes,
      },
    },
  ],
  framework: ['storybook-react-rsbuild'],
}
```

### Update `modern.config.ts`

Disable the `moduleFederationPlugin` when Storybook runs. One approach is to check an environment variable set by your Storybook scripts.

```json title="package.json"
{
  "scripts": {
    "storybook": "STORYBOOK=true storybook dev -p 6006"
  }
}
```

```ts title="modern.config.ts"
import { appTools, defineConfig } from '@modern-js/app-tools'
import { moduleFederationPlugin } from '@module-federation/modern-js'

// https://modernjs.dev/en/configure/app/usage
export default defineConfig({
  runtime: {
    router: true,
  },
  plugins: [
    appTools({
      bundler: 'rspack',
    }),
    ...(process.env.STORYBOOK ? [] : [moduleFederationPlugin()]),
  ],
})
```

## Limitations

Modern.js applies its own plugin system and transforms user configuration before passing it to Rsbuild. As a result, the addon cannot expose every feature inside Storybook.

### ✅ Supported

- Modern.js configuration files
- Modern.js plugins that adjust the configuration
- Rsbuild plugins

### ⚠️ Unsupported

- webpack builds (Rspack only)
- SSR configuration inside Storybook
- Runtime APIs such as `<Link>` navigation
- [Modern.js CLI plugins](https://modernjs.dev/plugin/cli-plugins/api.html) beyond their `config` and `resolveConfig` hooks

## Need help?

The Modern.js integration is provided through an addon rather than a full Storybook framework, so some platform features remain unavailable. Reach out with questions or ideas:

- [GitHub](https://github.com/web-infra-dev/modern.js)
- [Modern.js Discord](https://discord.gg/qPCqYg38De)
