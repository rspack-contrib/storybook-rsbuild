import { PackageManagerTabs } from '@theme'

# Rspack

Rsbuild is built on Rspack, so any configuration you apply in Rsbuild can work with raw Rspack projects too. This guide shows how to connect Storybook Rsbuild to an existing Rspack setup.

Explore the [Rspack React sandbox](https://github.com/rspack-contrib/storybook-rsbuild/tree/main/sandboxes/rspack-react-18) for a complete reference implementation.

## Setup

### 1. Install dependencies

Starting from a React example, install `storybook-react-rsbuild` (see the [React framework guide](/guide/framework/react)) and add the Rsbuild packages required for Rspack support.

<PackageManagerTabs command="install @rsbuild/core @rsbuild/plugin-react -D" />

Ensure the following packages are present:

- `storybook`
- `@rsbuild/core`
- `@rsbuild/plugin-react`
- `storybook-react-rsbuild`

### 2. Create `rsbuild.config.ts`

Storybook Rsbuild reads the project's Rsbuild config in the same way that [`@storybook/builder-webpack5` allows custom webpack configs](https://storybook.js.org/docs/builders/webpack#import-a-custom-webpack-configuration). Configure the basics for your Rspack app here.

```ts title="rsbuild.config.ts"
import { defineConfig } from '@rsbuild/core'
import { pluginReact } from '@rsbuild/plugin-react'

export default defineConfig({
  plugins: [pluginReact()],
})
```

### 3. Configure `.storybook/main.ts`

Match the setup from the [React framework guide](/guide/framework/react#configure-storybookmaints) so Storybook uses the Rsbuild builder.

```ts twoslash title=".storybook/main.ts"
// @noErrors
import { StorybookConfig } from 'storybook-react-rsbuild'

const config: StorybookConfig = {
  framework: 'storybook-react-rsbuild',
  stories: [],
  addons: []
}

export default config
```

At this point `npx storybook dev` should launch using the default `@rsbuild/core` and `@rsbuild/plugin-react` configuration. If your stories require additional Rspack features, continue with the next step.

### 4. Reuse custom Rspack options (optional)

Projects often maintain both `rspack.config.ts` (for the application build) and `rsbuild.config.ts` (for Storybook). Import the former into the latter and merge any rules or plugins through `tools.rspack`. Refer to [tools.rspack](https://rsbuild.rs/config/tools/rspack) for every customization hook.

The example below reuses a `less-loader` rule defined in `rspack.config.cjs`:

```ts title="rsbuild.config.ts" {3,7-13}
import { defineConfig } from '@rsbuild/core'
import { pluginReact } from '@rsbuild/plugin-react'
// import rspackConfig from './rspack.config.cjs'
const rspackConfig = { module: { rules: [{}, {}, { loader: 'less-loader' }] } } as any

export default defineConfig({
  plugins: [pluginReact()],
  tools: {
    rspack: (config) => {
      const lessLoader = rspackConfig.module.rules[2]
      config.module!.rules!.push(lessLoader)
      return config
    },
  },
})
```
